---
plugin: SimpleSampler
stage: 1
phase: null
status: complete
last_updated: 2025-12-19
complexity_score: 3.4
phased_implementation: true
orchestration_mode: true
next_action: invoke_dsp_agent
next_phase: 4.1
contract_checksums:
  creative_brief: sha256:96aee0da1cb4928a07777ce5e2f04328ada8bc81fbd386e1861058909fc46a1a
  parameter_spec: sha256:81e0f19fd515e3d2fcf128f2c558e0eb3ec131f2f035559390e702f586a9e180
  architecture: sha256:8ddbb65710c323f3dd5a1f67570a7ad300ef0037a07d3f9e90caa93e2b73a995
  plan: sha256:c8795a8b5c25c65ee3dea588041df00549e077513dec9c32d2ffee255c727076
---

# Resume Point

## Current State: Stage 1 - Foundation Complete

Build system operational, APVTS with 2 parameters implemented. Ready for DSP implementation (Phase 4.1).

## Completed So Far

**Stage 1 - Foundation:** ✓ Complete - Build system operational, 2 parameters implemented

**Ideation (Stage 0 - Creative Brief):** ✓ Complete
- Core concept: Minimal POC sampler for JUCE learning
- Parameters: Volume (0-1), Tuning (±12 semitones)
- Plugin type: Synth (Instrument)
- UI vision: GainKnob-style with sample loading

**UI Design (Stage 0 - Mockup):** ✓ v2 Finalized
- Layout: Vertical flow - sample loading (top), controls (bottom)
- Window: 500×350 (compact, fixed)
- Controls: Sample dropzone, Browse button (inside dropzone), 2 knobs
- Double-click reset on both knobs

**Research & Planning (Stage 0):** ✓ Complete - Architecture and plan documented (Complexity 3.4)
- Plugin type: Synth (Instrument) - 16-voice polyphonic sampler
- Professional plugins researched: Kontakt (256 voices), Battery (128 voices), DirectWave (128 voices)
- JUCE modules identified: juce::Synthesiser, juce::SynthesiserVoice, juce::SynthesiserSound, juce::AudioFormatManager
- Core architecture:
  - 16-voice polyphony with oldest-first voice stealing
  - Pitch-shifting via playback rate: pow(2.0, semitoneOffset / 12.0)
  - Thread-safe sample loading: Atomic pointer swap (background → audio thread)
  - Computer keyboard to MIDI: Major scale mapping via lock-free queue
  - Linear interpolation for sample reading (POC quality)
  - File formats: WAV, AIFF, MP3 via AudioFormatManager
- Complexity score: 3.4 (Complex)
- Implementation strategy: Phase-based (3 DSP phases, 2 GUI phases)
- Highest risk: Thread-safe sample loading (40% of project risk)
  - Mitigation: Atomic pointer swap, double-buffering, message thread deletion

## Next Steps

1. Build verification - Run build script to verify plugin compiles
2. Stage 2 Phase 4.1: Core Sample Playback (hardcoded sample, validate JUCE Synthesiser)
3. Stage 2 Phase 4.2: Thread-safe sample loading (drag-drop, atomic swap)
4. Stage 2 Phase 4.3: Computer keyboard to MIDI + tuning parameter integration

## Context to Preserve

**Architecture highlights:**
- 16-voice polyphonic sampler using JUCE Synthesiser infrastructure
- Root note: C3 (MIDI 60) plays sample at original pitch (1.0x playback rate)
- Pitch calculation: `semitoneOffset = (midiNote - 60) + tuningParameter`
- Playback rate: `pow(2.0, semitoneOffset / 12.0)`
- Thread-safe sample loading: Background load → atomic swap → message thread deletion
- Computer keyboard to MIDI: Lock-free queue (juce::AbstractFifo), major scale intervals
- Linear interpolation: Fast but acceptable quality for POC (upgrade to Lagrange post-testing)
- No ADSR envelope, no looping in POC (future expansion)

**Implementation phases (phased due to complexity 3.4):**
- **Phase 4.1:** Core sample playback (hardcoded sample, validate Synthesiser)
- **Phase 4.2:** Thread-safe sample loading (drag-drop, file browser, atomic swap)
- **Phase 4.3:** Computer keyboard to MIDI + tuning parameter
- **Phase 5.1:** Layout and basic controls (WebView setup, mockup integration)
- **Phase 5.2:** Parameter binding and file handling (two-way communication, drag-drop)

**Critical JUCE 8 patterns to follow:**
- Pattern #22: IS_SYNTH TRUE for instruments (REQUIRED)
- Pattern #12: WebSliderParameterAttachment 3-parameter signature (parameter, relay, nullptr)
- Pattern #15: valueChangedEvent callback receives no parameters (call getNormalisedValue() inside)
- Pattern #16: Relative knob drag (frame-delta, not absolute positioning)
- Pattern #21: ES6 module loading (type="module" required in script tags)
- Pattern #9: NEEDS_WEB_BROWSER TRUE in CMakeLists.txt (VST3 requirement)

**Key risks and mitigations:**
- **Highest risk (40%):** Thread-safe sample loading
  - Atomic pointer swap with acquire/release ordering
  - Double-buffering: Load to temp → atomic swap → delete old on message thread
  - Nullptr checks in audio thread
- **Medium risk:** Computer keyboard to MIDI (lock-free queue complexity)
  - Use juce::AbstractFifo (battle-tested, JUCE-native)
  - Bounded queue size (128 messages, drop if full)
- **Low risk:** Linear interpolation quality at extreme transposition
  - Document ±1-2 octave recommended range
  - Upgrade to Lagrange3rd interpolation post-POC if needed

**Performance estimates:**
- Synthesiser overhead: ~1-2% CPU
- Linear interpolation: ~5 CPU cycles per sample per voice
- 16 voices active: ~5-10% single core at 48kHz
- Total: Acceptable for POC, leaves headroom for future envelope/filters

## Files Created

**Stage 1 - Foundation:**
- plugins/SimpleSampler/CMakeLists.txt (Build system with IS_SYNTH TRUE, NEEDS_MIDI_INPUT TRUE, NEEDS_WEB_BROWSER TRUE)
- plugins/SimpleSampler/Source/PluginProcessor.h (APVTS, output-only BusesProperties)
- plugins/SimpleSampler/Source/PluginProcessor.cpp (2 parameters: volume, tuning)
- plugins/SimpleSampler/Source/PluginEditor.h (Minimal editor stub)
- plugins/SimpleSampler/Source/PluginEditor.cpp (Placeholder UI with parameter count)

**Stage 0 - Planning:**
- plugins/SimpleSampler/.ideas/architecture.md (Complete DSP specification)
- plugins/SimpleSampler/.ideas/plan.md (Phased implementation plan with 5 phases)

## Build Artifacts

After successful build:
- build/SimpleSampler_artefacts/VST3/SimpleSampler.vst3
- build/SimpleSampler_artefacts/AU/SimpleSampler.component
- build/SimpleSampler_artefacts/Standalone/SimpleSampler.app
