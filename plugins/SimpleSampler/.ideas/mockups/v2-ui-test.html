<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SimpleSampler UI Mockup v2</title>

  <style>
    /* ===== CRITICAL: WebView Constraints ===== */
    html, body {
      height: 100%;  /* REQUIRED - replaces viewport units */
      margin: 0;
      padding: 0;
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    /* ===== Native Application Feel ===== */
    body {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      cursor: default;
      overflow: hidden;

      /* Center plugin frame in browser for testing */
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    }

    /* ===== Plugin Frame (Test HTML Only) ===== */
    .plugin-frame {
      width: 500px;   /* Fixed size matching YAML spec */
      height: 350px;
      border: 2px solid #444;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      overflow: hidden;
      position: relative;
    }

    /* ===== Plugin Container ===== */
    .container {
      width: 100%;
      height: 100%;
      background: #1a1a1a;
      color: #ffffff;
      position: relative;
    }

    /* ===== Sample Loading Area ===== */
    .sample-area {
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 120px;
      padding: 0 40px;
    }

    .dropzone {
      position: absolute;
      left: 40px;
      top: 30px;
      width: 420px;
      height: 80px;
      background: #252525;
      border: 2px dashed #404040;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .dropzone:hover {
      border-color: #606060;
      background: #2a2a2a;
    }

    .dropzone.drag-over {
      border-color: #fff;
      background: #353535;
    }

    .dropzone-icon {
      font-size: 32px;
      margin-bottom: 8px;
      opacity: 0.4;
    }

    .dropzone-text {
      font-size: 14px;
      color: #888888;
      letter-spacing: 0.05em;
      text-align: center;
    }

    .sample-name {
      font-size: 13px;
      color: #ffffff;
      font-weight: 500;
      margin-top: 6px;
      text-align: center;
    }

    /* Browse button - NOW INSIDE DROPZONE */
    .browse-button {
      position: absolute;
      left: 50px;   /* Inside dropzone, top-left corner */
      top: 40px;
      width: 40px;
      height: 40px;
      background: #2a2a2a;
      border: 1px solid #404040;
      border-radius: 6px;
      color: #ffffff;
      font-size: 20px;  /* Icon size */
      cursor: pointer;
      transition: all 0.15s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;  /* Above dropzone content */
    }

    .browse-button:hover {
      background: #353535;
      border-color: #505050;
    }

    .browse-button:active {
      background: #1a1a1a;
      transform: scale(0.95);
    }

    /* ===== Controls Area ===== */
    .controls-area {
      position: absolute;
      top: 160px;
      left: 0;
      right: 0;
      height: 170px;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      gap: 60px;
    }

    /* ===== Knob Component ===== */
    .knob-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }

    .knob {
      width: 120px;
      height: 120px;
      position: relative;
      cursor: pointer;
      transform-origin: center center;
      transition: transform 50ms ease-out;
    }

    .knob-background {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: #2a2a2a;
      border: 3px solid #1a1a1a;
    }

    /* Fixed lighting layer - doesn't rotate */
    .knob-lighting {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      box-shadow:
        inset -3px -3px 8px rgba(0,0,0,0.6),
        inset 3px 3px 8px rgba(255,255,255,0.05);
      pointer-events: none;
      z-index: 2;
    }

    /* Rotating body - texture + indicator */
    .knob-body {
      position: absolute;
      inset: 0;
      transform-origin: center center;
      transition: transform 50ms ease-out;
      z-index: 1;
    }

    .knob-indicator {
      position: absolute;
      top: 12px;
      left: 50%;
      transform: translateX(-50%);
      width: 3px;
      height: 40px;
      background: #ffffff;
      border-radius: 2px;
    }

    .knob-track {
      position: absolute;
      inset: 8px;
      border-radius: 50%;
      border: 2px solid #404040;
    }

    .knob-label {
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #ffffff;
      font-weight: 500;
    }

    .knob-value {
      font-size: 16px;
      color: #888888;
      font-weight: 400;
      font-variant-numeric: tabular-nums;
    }

    /* ===== Debug Monitor (Test HTML Only) ===== */
    .debug-monitor {
      position: fixed;
      bottom: 10px;
      right: 10px;
      background: rgba(0, 0, 0, 0.9);
      color: #0f0;
      font-family: 'Courier New', monospace;
      font-size: 11px;
      padding: 10px 14px;
      border: 1px solid #333;
      border-radius: 4px;
      min-width: 180px;
      pointer-events: none;
      z-index: 10000;
      line-height: 1.5;
    }

    .debug-label {
      color: #666;
      font-size: 9px;
      margin-bottom: 6px;
      letter-spacing: 1px;
    }

    .debug-param {
      font-weight: bold;
      color: #0f0;
      margin-bottom: 2px;
    }

    .debug-value {
      color: #fff;
      margin-bottom: 2px;
    }

    .debug-normalized {
      color: #888;
      font-size: 10px;
    }

    .debug-action {
      color: #ff0;
      margin-top: 4px;
      font-size: 10px;
    }

    /* Hidden file input */
    #fileInput {
      display: none;
    }
  </style>
</head>
<body>
  <!-- Fixed-size plugin frame for testing -->
  <div class="plugin-frame">
    <div class="container">

      <!-- Sample Loading Area -->
      <div class="sample-area">
        <div class="dropzone" id="dropzone">
          <div class="dropzone-icon">‚ô™</div>
          <div class="dropzone-text">Drop audio file here</div>
          <div class="sample-name" id="sampleName" style="display: none;"></div>
        </div>
        <!-- Browse button NOW INSIDE dropzone, top-left corner -->
        <div class="browse-button" id="browseBtn">üìÅ</div>
        <input type="file" id="fileInput" accept=".wav,.aiff,.mp3" />
      </div>

      <!-- Controls Area -->
      <div class="controls-area">

        <!-- Volume Knob -->
        <div class="knob-container">
          <div class="knob" id="volumeKnob" data-param="volume" data-min="0" data-max="1" data-value="0.75" data-default="0.75">
            <div class="knob-background"></div>
            <div class="knob-lighting"></div>
            <div class="knob-body" id="volumeBody">
              <div class="knob-track"></div>
              <div class="knob-indicator"></div>
            </div>
          </div>
          <div class="knob-label">Volume</div>
          <div class="knob-value" id="volumeValue">0.75</div>
        </div>

        <!-- Tuning Knob -->
        <div class="knob-container">
          <div class="knob" id="tuningKnob" data-param="tuning" data-min="-12" data-max="12" data-value="0" data-default="0">
            <div class="knob-background"></div>
            <div class="knob-lighting"></div>
            <div class="knob-body" id="tuningBody">
              <div class="knob-track"></div>
              <div class="knob-indicator"></div>
            </div>
          </div>
          <div class="knob-label">Tuning</div>
          <div class="knob-value" id="tuningValue">0.0 st</div>
        </div>

      </div>

    </div>
  </div>

  <!-- Debug Monitor -->
  <div class="debug-monitor">
    <div class="debug-label">PARAMETER MONITOR</div>
    <div class="debug-param" id="debugParam">‚Äî</div>
    <div class="debug-value" id="debugValue">‚Äî</div>
    <div class="debug-normalized" id="debugNormalized">‚Äî</div>
    <div class="debug-action" id="debugAction"></div>
  </div>

  <script>
    // ===== Mock JUCE Backend =====
    window.Juce = {
      getSliderState: (id) => ({
        normalisedValue: 0.5,
        valueChangedEvent: {
          addListener: (fn) => console.log(`‚úì Listener added for ${id}`)
        },
        setNormalisedValue: (v) => console.log(`‚Üí JUCE: ${id} = ${v}`)
      }),
      getToggleState: (id) => ({
        value: false,
        valueChangedEvent: {
          addListener: (fn) => console.log(`‚úì Listener added for ${id}`)
        }
      }),
      getComboBoxState: (id) => ({
        selectedId: 0,
        valueChangedEvent: {
          addListener: (fn) => console.log(`‚úì Listener added for ${id}`)
        }
      })
    };

    // ===== Disable Context Menu (REQUIRED) =====
    document.addEventListener("contextmenu", (e) => {
      e.preventDefault();
      return false;
    });

    // ===== Disable Default Drag Behaviors =====
    document.addEventListener("dragstart", (e) => {
      e.preventDefault();
    });

    // ===== Debug Monitor Update =====
    function updateDebugMonitor(paramId, value, normalizedValue, action = '') {
      document.getElementById('debugParam').textContent = paramId;
      document.getElementById('debugValue').textContent = value;
      document.getElementById('debugNormalized').textContent = `${(normalizedValue * 100).toFixed(1)}%`;
      document.getElementById('debugAction').textContent = action;

      // Clear action after 2 seconds
      if (action) {
        setTimeout(() => {
          document.getElementById('debugAction').textContent = '';
        }, 2000);
      }
    }

    // ===== Knob Control Implementation =====
    class Knob {
      constructor(element) {
        this.element = element;
        this.body = element.querySelector('.knob-body');
        this.valueDisplay = element.parentElement.querySelector('.knob-value');
        this.paramId = element.dataset.param;
        this.min = parseFloat(element.dataset.min);
        this.max = parseFloat(element.dataset.max);
        this.value = parseFloat(element.dataset.value);
        this.defaultValue = parseFloat(element.dataset.default);

        this.isDragging = false;
        this.startY = 0;
        this.startValue = 0;
        this.lastClickTime = 0;

        this.setupEventListeners();
        this.updateRotation();
        this.updateDisplay();
      }

      setupEventListeners() {
        // Double-click to reset
        this.element.addEventListener('dblclick', this.onDoubleClick.bind(this));

        // Drag control
        this.element.addEventListener('mousedown', this.onMouseDown.bind(this));
        document.addEventListener('mousemove', this.onMouseMove.bind(this));
        document.addEventListener('mouseup', this.onMouseUp.bind(this));

        // Mouse wheel support
        this.element.addEventListener('wheel', this.onWheel.bind(this), { passive: false });
      }

      onDoubleClick(e) {
        e.preventDefault();
        console.log(`‚úì Double-click reset: ${this.paramId} ‚Üí ${this.defaultValue}`);
        this.setValue(this.defaultValue);

        // Update debug monitor with action
        const normalized = (this.value - this.min) / (this.max - this.min);
        const formattedValue = this.formatValue();
        updateDebugMonitor(this.paramId, formattedValue, normalized, '‚ü≥ RESET TO DEFAULT');
      }

      onMouseDown(e) {
        // Prevent drag if this is part of double-click
        const now = Date.now();
        if (now - this.lastClickTime < 300) {
          return;  // Let double-click handler take over
        }
        this.lastClickTime = now;

        this.isDragging = true;
        this.startY = e.clientY;
        this.startValue = this.value;
        e.preventDefault();
      }

      onMouseMove(e) {
        if (!this.isDragging) return;

        const deltaY = this.startY - e.clientY;
        const range = this.max - this.min;
        const sensitivity = 0.005;
        const delta = deltaY * range * sensitivity;

        this.setValue(this.startValue + delta);
      }

      onMouseUp() {
        this.isDragging = false;
      }

      onWheel(e) {
        e.preventDefault();
        const range = this.max - this.min;
        const delta = -e.deltaY * range * 0.001;
        this.setValue(this.value + delta);
      }

      setValue(newValue) {
        this.value = Math.max(this.min, Math.min(this.max, newValue));
        this.updateRotation();
        this.updateDisplay();

        // Notify mock JUCE backend
        const normalized = (this.value - this.min) / (this.max - this.min);
        if (window.Juce) {
          const state = Juce.getSliderState(this.paramId);
          state.setNormalisedValue(normalized);
        }

        // Update debug monitor
        const formattedValue = this.formatValue();
        updateDebugMonitor(this.paramId, formattedValue, normalized);
      }

      updateRotation() {
        const normalized = (this.value - this.min) / (this.max - this.min);
        const degrees = -135 + (normalized * 270);  // -135¬∞ to +135¬∞
        this.body.style.transform = `rotate(${degrees}deg)`;
      }

      updateDisplay() {
        this.valueDisplay.textContent = this.formatValue();
      }

      formatValue() {
        if (this.paramId === 'volume') {
          return this.value.toFixed(2);
        } else if (this.paramId === 'tuning') {
          return this.value.toFixed(1) + ' st';
        }
        return this.value.toFixed(1);
      }
    }

    // ===== Sample Loading Implementation =====
    const dropzone = document.getElementById('dropzone');
    const browseBtn = document.getElementById('browseBtn');
    const fileInput = document.getElementById('fileInput');
    const sampleName = document.getElementById('sampleName');
    const dropzoneText = dropzone.querySelector('.dropzone-text');

    // Drag and drop handlers
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.classList.add('drag-over');
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.classList.remove('drag-over');
    });

    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.classList.remove('drag-over');

      const files = e.dataTransfer.files;
      if (files.length > 0) {
        loadSample(files[0]);
      }
    });

    // Click to browse
    dropzone.addEventListener('click', (e) => {
      // Don't trigger if clicking browse button
      if (e.target.closest('.browse-button')) return;
      fileInput.click();
    });

    browseBtn.addEventListener('click', (e) => {
      e.stopPropagation();  // Prevent dropzone click
      fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
      if (e.target.files.length > 0) {
        loadSample(e.target.files[0]);
      }
    });

    function loadSample(file) {
      console.log('‚Üí JUCE: Loading sample:', file.name);

      // Update UI to show loaded sample
      dropzoneText.style.display = 'none';
      sampleName.textContent = file.name;
      sampleName.style.display = 'block';
      dropzone.style.borderStyle = 'solid';
      dropzone.style.borderColor = '#666';

      // In real implementation, this would:
      // 1. Send file path to C++ via window.__JUCE__.backend
      // 2. C++ loads audio file into memory
      // 3. C++ sends confirmation back to JavaScript
    }

    // ===== Initialize Controls =====
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize knobs
      const volumeKnob = new Knob(document.getElementById('volumeKnob'));
      const tuningKnob = new Knob(document.getElementById('tuningKnob'));

      console.log('‚úì SimpleSampler UI v2 initialized');
      console.log('‚úì Mock JUCE backend ready');
      console.log('‚úì Parameter bindings active');
      console.log('');
      console.log('Controls:');
      console.log('  - Drag knobs vertically to adjust');
      console.log('  - Double-click knobs to reset to default');
      console.log('  - Scroll wheel on knobs for fine control');
      console.log('  - Drag & drop audio files onto dropzone');
      console.log('  - Click folder icon (üìÅ) to browse files');
      console.log('');
      console.log('v2 Changes:');
      console.log('  - Browse button moved inside dropzone (top-left)');
      console.log('  - Browse button now icon-only (üìÅ)');
      console.log('  - Knobs support double-click reset');
    });
  </script>
</body>
</html>
